<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>èªé †ã§GOï¼ - ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ¡ãƒ‹ãƒ¥ãƒ¼</title>

    <style>
      :root{
        --bg:#fff7ed; --panel:#fff1e6; --border:#ffd7b8;
        --text:#3b2a1a; --muted:#8a6a4a;
        --accent:#f97316; --accent-600:#ea580c; --accent-100:#ffedd5;
      }
      *{ box-sizing:border-box; }
      html,body{ height:100%; margin:0; }
      body{
        margin:16px;
        font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,
          "Noto Sans JP","Hiragino Kaku Gothic ProN","Yu Gothic",Meiryo,sans-serif;
        color:var(--text);
        background:
          radial-gradient(1000px 600px at 20% -10%, #fff 10%, var(--bg) 60%),
          radial-gradient(800px 500px at 120% 10%, #fff 0%, var(--bg) 60%);
        display:flex;
        align-items:center;
        justify-content:center;
      }

      .frame{
        width:min(760px, 100% - 16px);
        background:var(--panel);
        border:2px solid var(--border);
        border-radius:22px;
        padding:18px 18px 16px;
        box-shadow:0 14px 35px rgba(249,115,22,.18);
      }

      .top{
        display:flex;
        align-items:center;
        justify-content:space-between;
        gap:10px;
        flex-wrap:wrap;
        margin-bottom:10px;
      }
      h1{
        margin:0;
        font-size:clamp(22px,3vw,34px);
        font-weight:900;
        letter-spacing:.04em;
        background:linear-gradient(90deg,var(--accent) 0%,#fb923c 40%,#f59e0b 100%);
        -webkit-background-clip:text;
        background-clip:text;
        color:transparent;
      }
      .tag{
        padding:6px 12px;
        border-radius:999px;
        border:1px solid #fed7aa;
        background:#fff;
        font-weight:800;
        color:#b45309;
        white-space:nowrap;
      }

      .sub{
        margin:6px 0 14px;
        color:var(--muted);
        font-size:14px;
        line-height:1.5;
      }

      .cards{
        display:grid;
        grid-template-columns:1fr;
        gap:12px;
      }
      @media (min-width: 700px){
        .cards{ grid-template-columns:1fr 1fr; }
      }

      .card{
        background:#fff;
        border:2px solid var(--border);
        border-radius:18px;
        padding:14px 14px 12px;
        box-shadow:0 6px 16px rgba(0,0,0,.06);
      }
      .card-title{
        font-size:18px;
        font-weight:900;
        margin:0 0 6px;
      }
      .card-desc{
        margin:0 0 10px;
        color:var(--muted);
        font-size:13px;
        line-height:1.5;
      }

      .lockinfo{
        display:flex;
        align-items:center;
        gap:8px;
        margin:0 0 10px;
        font-size:13px;
        font-weight:900;
        color:#92400e;
        min-height:20px;
      }
      .pill{
        display:inline-flex;
        align-items:center;
        gap:6px;
        padding:4px 10px;
        border-radius:999px;
        border:1px solid #fed7aa;
        background:#fff7ed;
        white-space:nowrap;
      }
      .pill.ok{
        border-color:#bbf7d0;
        background:#dcfce7;
        color:#14532d;
      }
      .pill.ng{
        border-color:#fecaca;
        background:#fee2e2;
        color:#7f1d1d;
      }

      .btn{
        width:100%;
        min-height:52px;
        border-radius:16px;
        border:2px solid var(--border);
        cursor:pointer;
        font-weight:900;
        font-size:16px;
        box-shadow:0 4px 10px rgba(0,0,0,.10);
        transition:transform .04s, box-shadow .15s, filter .15s;
      }
      .btn:hover{ box-shadow:0 10px 22px rgba(249,115,22,.18); }
      .btn:active{ transform:translateY(1px); }

      .btn:disabled{
        cursor:not-allowed;
        filter:grayscale(.25);
        opacity:.65;
        box-shadow:none;
      }

      .btn-primary{
        background:linear-gradient(180deg,#ffb777 0%,#ff914d 100%);
        border-color:#ffb777;
        color:#3b2314;
      }
      .btn-boss{
        background:linear-gradient(180deg,#fde68a 0%,#f59e0b 100%);
        border-color:#f59e0b;
        color:#3b2314;
      }

      .footer{
        display:flex;
        justify-content:center; /* â˜…å¾©ç¿’ãƒœã‚¿ãƒ³æ’¤å» â†’ ä¸­å¤®å¯„ã› */
        align-items:center;
        gap:10px;
        flex-wrap:wrap;
        margin-top:14px;
      }
      .mini{
        border-radius:999px;
        border:1px solid #fed7aa;
        background:#ffffffcc;
        padding:10px 18px;
        cursor:pointer;
        font-weight:900;
        color:#7c4a1d;
        font-size:14px;
      }
      .mini:hover{ background:var(--accent-100); }

      .warn{
        margin-top:8px;
        font-size:12px;
        color:#b45309;
        display:none;
      }
      .warn.show{ display:block; }

      /* ===== è§£æ”¾ãƒ¢ãƒ¼ãƒ€ãƒ« ===== */
      .modal{
        position:fixed;
        inset:0;
        z-index:200;
        display:none;
        align-items:center;
        justify-content:center;
        background:rgba(0,0,0,.25);
      }
      .modal.show{ display:flex; }
      .modal-card{
        width:min(360px, calc(100% - 40px));
        background:#fff;
        border:2px solid var(--border);
        border-radius:18px;
        padding:14px 14px 12px;
        box-shadow:0 16px 40px rgba(0,0,0,.22);
        text-align:center;
      }
      .modal-title{
        font-size:18px;
        font-weight:900;
        margin:2px 0 6px;
      }
      .modal-text{
        margin:0 0 12px;
        color:var(--muted);
        font-size:14px;
        line-height:1.5;
      }
      .modal-btns{
        display:flex;
        gap:8px;
      }
      .modal-btns button{
        width:100%;
        min-height:46px;
        border-radius:14px;
        border:2px solid var(--border);
        font-weight:900;
        cursor:pointer;
      }
      .modal-btns .ok{
        background:linear-gradient(180deg,#ffb777 0%,#ff914d 100%);
        border-color:#ffb777;
      }

      /* ===== æ¼”å‡º ===== */
      .fx-layer{
        position:fixed;
        inset:0;
        z-index:210;
        pointer-events:none;
        overflow:hidden;
      }
      .coin{
        position:absolute;
        width:18px;
        height:18px;
        border-radius:999px;
        background:radial-gradient(circle at 30% 30%, #fff 0%, #fde68a 30%, #f59e0b 70%, #b45309 100%);
        box-shadow:0 10px 18px rgba(0,0,0,.18);
        animation:fly 700ms ease-out forwards;
      }
      @keyframes fly{
        from{ transform:translate(var(--sx), var(--sy)) scale(1); opacity:1; }
        to{ transform:translate(var(--tx), var(--ty)) scale(.6); opacity:0; }
      }
      .bigpop{
        position:fixed;
        inset:0;
        z-index:220;
        display:none;
        align-items:center;
        justify-content:center;
        pointer-events:none;
      }
      .bigpop.show{ display:flex; }
      .bigpop-card{
        background:#fff;
        border:3px solid #fdba74;
        border-radius:22px;
        padding:18px 22px;
        box-shadow:0 18px 50px rgba(249,115,22,.25);
        text-align:center;
        transform:scale(.9);
        animation:pop .25s ease forwards;
      }
      .bigpop-title{
        margin:0;
        font-size:34px;
        font-weight:900;
        color:var(--accent-600);
      }
      .bigpop-sub{
        margin:6px 0 0;
        color:var(--muted);
        font-weight:900;
        font-size:14px;
      }
      @keyframes pop{ to{ transform:scale(1); } }
    </style>
  </head>

  <body>
    <div class="frame">
      <div class="top">
        <h1>ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ¡ãƒ‹ãƒ¥ãƒ¼</h1>
        <div id="unitTag" class="tag">Unit ?</div>
      </div>

      <div class="sub">
        ã©ã£ã¡ã§éŠã¶ï¼Ÿ<br>
        ã€Œãƒœã‚¹è¨ä¼ã€ã¯ã€è§£æ”¾ã™ã‚‹ã¨ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã¨ã—ã¦è¨˜éŒ²ã§ãã‚‹å…¥å£ã‹ã‚‰å…¥ã‚Œã‚‹ã‚ˆğŸ‘‘
      </div>

      <div class="cards">
        <div class="card">
          <!-- â˜…åå‰ã‚’è‡ªç„¶ã« -->
          <div class="card-title">1èªã„ã‚‰ãªã„ãƒãƒ£ãƒ¬ãƒ³ã‚¸</div>
          <p class="card-desc">
            ã‚ˆã‘ã„ãªå˜èªãŒ1ã¤ã¾ã–ã£ã¦ã‚‹ï¼ã²ã£ã‹ã‹ã‚‰ãšã«ã€æ­£ã—ã„æ–‡ã ã‘ä½œã‚ã†ğŸ”¥
          </p>
          <div class="lockinfo"><span class="pill ok">âœ… ã„ã¤ã§ã‚‚OK</span></div>
          <button id="btnExtra" class="btn btn-primary" type="button">ã¯ã˜ã‚ã‚‹</button>
        </div>

        <div class="card">
          <div class="card-title">ãƒœã‚¹è¨ä¼</div>
          <p class="card-desc">
            ãƒœã‚¹ã«æŒ‘æˆ¦ï¼è§£æ”¾ã™ã‚‹ã¨ã€ã“ã®å…¥å£ã‹ã‚‰å…¥ã£ã¦<strong>ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã¨ã—ã¦è¨˜éŒ²</strong>ã•ã‚Œã‚‹ã‚ˆğŸ‘‘
          </p>
          <div id="bossLockInfo" class="lockinfo"></div>
          <button id="btnBoss" class="btn btn-boss" type="button">ãƒœã‚¹ã¸</button>
        </div>
      </div>

      <div class="footer">
        <button id="btnBackHome" class="mini" type="button">ãƒ›ãƒ¼ãƒ ã«ã‚‚ã©ã‚‹</button>
      </div>

      <div id="warn" class="warn">âš ï¸ ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ã‚‚ã†ä¸€åº¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã­ã€‚</div>
    </div>

    <!-- è§£æ”¾ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆãƒœã‚¹ç”¨ï¼‰ -->
    <div id="unlockModal" class="modal" aria-hidden="true">
      <div class="modal-card">
        <div id="mTitle" class="modal-title">ğŸ”“ ãƒœã‚¹è¨ä¼ã‚’è§£æ”¾ã™ã‚‹ï¼Ÿ</div>
        <div id="mText" class="modal-text">ã‚³ã‚¤ãƒ³ã‚’ã¤ã‹ã£ã¦è§£æ”¾ã™ã‚‹ã‚ˆã€‚</div>
        <div class="modal-btns">
          <button id="mCancel" type="button">ã‚„ã‚ã‚‹</button>
          <button id="mOk" class="ok" type="button">è§£æ”¾ã™ã‚‹</button>
        </div>
      </div>
    </div>

    <!-- æ¼”å‡ºãƒ¬ã‚¤ãƒ¤ -->
    <div id="fxLayer" class="fx-layer"></div>
    <div id="bigPop" class="bigpop">
      <div class="bigpop-card">
        <p class="bigpop-title">ğŸ‰ ã‚¢ãƒ³ãƒ­ãƒƒã‚¯ï¼</p>
        <p class="bigpop-sub">ã‚„ã£ãŸã­ï¼</p>
      </div>
    </div>

    <script>
      // ===== EXEC_BASE è‡ªå‹•è¿½å¾“ =====
      const STORAGE_KEY_BASE = 'go_execBaseUrl';
      const EXEC_BASE = (() => {
        const url = '<?= ScriptApp.getService().getUrl() ?>' || '';
        const base = (url.split('?')[0] || '').trim();
        const fallback = (() => {
          try{
            const u = new URL(window.location.href);
            return u.origin + u.pathname;
          }catch(e){
            return window.location.href;
          }
        })();
        const decided = base || sessionStorage.getItem(STORAGE_KEY_BASE) || fallback;
        try{ sessionStorage.setItem(STORAGE_KEY_BASE, decided); }catch(e){}
        return decided;
      })();

      const EMBED_TOKEN = '<?= typeof token !== "undefined" ? token : "" ?>';
      const EMBED_UNIT  = '<?= typeof unit  !== "undefined" ? unit  : "" ?>';

      let TOKEN = '';
      let UNIT  = '';

      function resolveParams(cb){
        if (EMBED_TOKEN) TOKEN = String(EMBED_TOKEN);
        if (EMBED_UNIT)  UNIT  = String(EMBED_UNIT);

        const p = new URLSearchParams(location.search);
        if (!TOKEN) TOKEN = p.get('t') || '';
        if (!UNIT)  UNIT  = p.get('unit') || '';

        if ((!TOKEN || !UNIT) && window.google && google.script && google.script.url){
          google.script.url.getLocation(loc => {
            const prm = (loc && loc.parameter) ? loc.parameter : {};
            if (!TOKEN && prm.t) TOKEN = String(prm.t);
            if (!UNIT  && prm.unit) UNIT = String(prm.unit);
            cb();
          });
          return;
        }
        cb();
      }

      function showWarn(v){
        const el = document.getElementById('warn');
        if (!el) return;
        el.classList.toggle('show', !!v);
      }

      function go(url){
        try{ window.top.location.href = url; }
        catch(_){ window.location.href = url; }
      }

      function goHome(){
        if (!TOKEN){ showWarn(true); return; }
        go(EXEC_BASE + '?t=' + encodeURIComponent(TOKEN));
      }

      function goExtraChallenge(){
        if (!TOKEN){ showWarn(true); return; }
        go(
          EXEC_BASE
          + '?page=game_challenge'
          + '&t=' + encodeURIComponent(TOKEN)
          + '&unit=' + encodeURIComponent(UNIT || '')
          + '&mode=' + encodeURIComponent('challenge')
        );
      }

      function goBossChallenge(){
        if (!TOKEN){ showWarn(true); return; }
        go(
          EXEC_BASE
          + '?page=game_boss'
          + '&t=' + encodeURIComponent(TOKEN)
          + '&unit=' + encodeURIComponent(UNIT || '')
          + '&as=' + encodeURIComponent('challenge')
        );
      }

      // =========================
      // ã‚³ã‚¤ãƒ³ã§ã€Œãƒœã‚¹è¨ä¼ã€ã‚’è§£æ”¾
      // =========================
      const BOSS_COST = 10; // â˜…ã“ã“ã‚’å¤‰ãˆã‚Œã°å¿…è¦ã‚³ã‚¤ãƒ³ã‚’èª¿æ•´ã§ãã‚‹

      let menuStatus = {
        coins: 0,
        bossUnlocked: false
      };

      function unitNumber(){
        const n = Number(UNIT);
        return Number.isFinite(n) ? n : 0;
      }

      function setUnitTag(){
        const el = document.getElementById('unitTag');
        if (!el) return;
        const base = `Unit ${UNIT || '?'}`;
        el.textContent = `${base} / ğŸª™ ${menuStatus.coins}`;
      }

      function readLocalStatus(){
        // Homeã§ä¿å­˜ã—ãŸ sessionStorage ã‚’ä½¿ã†ï¼ˆGASãŒãªãã¦ã‚‚æœ€ä½é™å‹•ãï¼‰
        const u = unitNumber() || 0;
        const c = Number(sessionStorage.getItem(`go_coin_${TOKEN}_u${u}`) || 0);
        const unlocked = sessionStorage.getItem(`go_unlockChallenge_${TOKEN}_u${u}`) === '1';
        menuStatus.coins = Number.isFinite(c) ? c : 0;
        menuStatus.bossUnlocked = !!unlocked;
      }

      function renderBossLock(){
        const info = document.getElementById('bossLockInfo');
        const btn  = document.getElementById('btnBoss');
        if (!info || !btn) return;

        if (menuStatus.bossUnlocked){
          info.innerHTML = `<span class="pill ok">âœ… è§£æ”¾æ¸ˆã¿</span>`;
          btn.disabled = false;
          return;
        }

        const coins = menuStatus.coins;
        if (coins >= BOSS_COST){
          info.innerHTML = `<span class="pill">ğŸ”’ ${BOSS_COST} ğŸª™ ã§è§£æ”¾ã§ãã‚‹</span>`;
          btn.disabled = false; // æŠ¼ã—ãŸã‚‰è§£æ”¾ãƒ¢ãƒ¼ãƒ€ãƒ«ã¸
        }else{
          info.innerHTML = `<span class="pill ng">ğŸ”’ ${BOSS_COST} ğŸª™ å¿…è¦ï¼ˆã„ã¾ ${coins}ï¼‰</span>`;
          btn.disabled = true;  // â˜…ã“ã“ã§ã€ŒæŠ¼ã›ãªã„ã€ã‚’ä¿è¨¼
        }
      }

      function openUnlockModal(){
        const m = document.getElementById('unlockModal');
        const t = document.getElementById('mTitle');
        const x = document.getElementById('mText');
        if (t) t.textContent = `ğŸ”“ ãƒœã‚¹è¨ä¼ã‚’è§£æ”¾ã™ã‚‹ï¼Ÿ`;
        if (x) x.textContent = `ã‚³ã‚¤ãƒ³ ${BOSS_COST} æšã¤ã‹ã£ã¦è§£æ”¾ã™ã‚‹ã‚ˆ ğŸª™`;
        if (m) m.classList.add('show');
      }

      function closeUnlockModal(){
        const m = document.getElementById('unlockModal');
        if (m) m.classList.remove('show');
      }

      function playUnlockFx(){
        try{ if (navigator.vibrate) navigator.vibrate([60,40,60]); }catch(e){}

        // ãƒãƒ£ãƒªãƒ³éŸ³ï¼ˆè»½é‡ï¼‰
        try{
          const ctx = new (window.AudioContext||window.webkitAudioContext)();
          const now = ctx.currentTime;
          const o = ctx.createOscillator();
          const g = ctx.createGain();
          o.type = 'triangle';
          o.frequency.setValueAtTime(880, now);
          g.gain.setValueAtTime(0.0001, now);
          g.gain.exponentialRampToValueAtTime(0.35, now+0.01);
          g.gain.exponentialRampToValueAtTime(0.0001, now+0.18);
          o.connect(g).connect(ctx.destination);
          o.start(now);
          o.stop(now+0.2);
        }catch(e){}

        const fx = document.getElementById('fxLayer');
        if (fx){
          const N = 26;
          for (let i=0;i<N;i++){
            const c = document.createElement('div');
            c.className = 'coin';
            const sx = (Math.random()*window.innerWidth) | 0;
            const sy = (window.innerHeight + 40 + Math.random()*120) | 0;
            const tx = (window.innerWidth/2 + (Math.random()-0.5)*140) | 0;
            const ty = (120 + Math.random()*140) | 0;

            c.style.left = sx + 'px';
            c.style.top  = sy + 'px';
            c.style.setProperty('--sx', '0px');
            c.style.setProperty('--sy', '0px');
            c.style.setProperty('--tx', (tx - sx) + 'px');
            c.style.setProperty('--ty', (ty - sy) + 'px');

            fx.appendChild(c);
            setTimeout(()=>c.remove(), 900);
          }
        }

        const pop = document.getElementById('bigPop');
        if (pop){
          pop.classList.add('show');
          setTimeout(()=>pop.classList.remove('show'), 900);
        }
      }

      // GASå´ unlockByCoins ãŒã‚ã‚‹å‰æï¼ˆãªãã¦ã‚‚ç”»é¢ã¯å£Šã•ãªã„ï¼‰
      function doUnlockBoss(){
        if (!TOKEN) return;

        // å¿µã®ãŸã‚ã€è¶³ã‚Šãªã„ãªã‚‰æ­¢ã‚ã‚‹
        if (menuStatus.coins < BOSS_COST){
          alert(`ã‚³ã‚¤ãƒ³ãŒè¶³ã‚Šãªã„ã‚ˆ ğŸª™\nå¿…è¦ï¼š${BOSS_COST}\nã„ã¾ï¼š${menuStatus.coins}`);
          return;
        }

        // GASãŒã‚ã‚Œã°æ°¸ç¶šè§£æ”¾ï¼‹ã‚³ã‚¤ãƒ³æ¶ˆè²»
        try{
          if (!(window.google && google.script && google.script.run)){
            alert('è§£æ”¾æ©Ÿèƒ½ãŒã¾ã æº–å‚™ä¸­ã§ã™ğŸ™ï¼ˆå…ˆç”Ÿã«è¨€ã£ã¦ã­ï¼‰');
            return;
          }

          google.script.run
            .withSuccessHandler(s=>{
              if (!s || s.ok !== true){
                alert(s?.message || 'è§£æ”¾ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚');
                return;
              }

              // æœŸå¾…ï¼š{ok:true, coins:<æ®‹ã‚Š>, bossUnlocked:true} ã‚’è¿”ã™æƒ³å®š
              menuStatus.coins = Number(s.coins ?? menuStatus.coins);
              menuStatus.bossUnlocked = !!(s.bossUnlocked ?? true);

              // sessionStorageã‚‚æ›´æ–°ï¼ˆHomeã«æˆ»ã‚‰ãªãã¦ã‚‚åæ˜ ï¼‰
              try{
                const u = unitNumber();
                sessionStorage.setItem(`go_coin_${TOKEN}_u${u}`, String(menuStatus.coins));
                sessionStorage.setItem(`go_unlockChallenge_${TOKEN}_u${u}`, menuStatus.bossUnlocked ? '1' : '0');
              }catch(e){}

              setUnitTag();
              renderBossLock();

              playUnlockFx();

              setTimeout(()=>goBossChallenge(), 650);
            })
            .withFailureHandler(err=>{
              alert('è§£æ”¾ã‚¨ãƒ©ãƒ¼: ' + (err?.message || err));
            })
            // â˜…featureKey ã¯ 'boss' å›ºå®šã§é€ã‚‹ï¼ˆGASå´ã§åˆ¤å®šã—ã‚„ã™ã„ï¼‰
            .unlockByCoins(TOKEN, unitNumber(), 'boss');

        }catch(e){
          alert('è§£æ”¾æ©Ÿèƒ½ãŒã¾ã æº–å‚™ä¸­ã§ã™ğŸ™ï¼ˆGASå´ã®é–¢æ•°ã‚’è¿½åŠ ã—ã¦ã­ï¼‰');
        }
      }

      // ã‚‚ã—GASã« getChallengeMenuStatus ãŒã‚ã‚‹ãªã‚‰ã€æœ€æ–°ã§ä¸Šæ›¸ãï¼ˆãªãã¦ã‚‚OKï¼‰
      function fetchMenuStatus(){
        try{
          if (!(window.google && google.script && google.script.run)) return;

          google.script.run
            .withSuccessHandler(s=>{
              if (!s || s.ok !== true) return;
              // æœŸå¾…ï¼š{ok:true, coins:<unit coins>, bossUnlocked:<bool>} ã‚’è¿”ã™æƒ³å®š
              menuStatus.coins = Number(s.coins ?? menuStatus.coins);
              menuStatus.bossUnlocked = !!(s.bossUnlocked ?? menuStatus.bossUnlocked);

              // sessionStorageæ›´æ–°
              try{
                const u = unitNumber();
                sessionStorage.setItem(`go_coin_${TOKEN}_u${u}`, String(menuStatus.coins));
                sessionStorage.setItem(`go_unlockChallenge_${TOKEN}_u${u}`, menuStatus.bossUnlocked ? '1' : '0');
              }catch(e){}

              setUnitTag();
              renderBossLock();
            })
            .withFailureHandler(_=>{})
            .getChallengeMenuStatus(TOKEN, unitNumber());
        }catch(e){}
      }

      window.addEventListener('load', () => {
        resolveParams(() => {
          if (!TOKEN){ showWarn(true); }

          // ã¾ãšãƒ­ãƒ¼ã‚«ãƒ«ã§å³è¡¨ç¤º
          readLocalStatus();
          setUnitTag();
          renderBossLock();

          // ãƒœã‚¿ãƒ³
          document.getElementById('btnBackHome').addEventListener('click', goHome);
          document.getElementById('btnExtra').addEventListener('click', goExtraChallenge);

          // ãƒœã‚¹ï¼šæœªè§£æ”¾ãªã‚‰ãƒ¢ãƒ¼ãƒ€ãƒ«ã€è§£æ”¾æ¸ˆã¿ãªã‚‰çªå…¥
          document.getElementById('btnBoss').addEventListener('click', () => {
            if (!TOKEN){ showWarn(true); return; }
            if (menuStatus.bossUnlocked){
              goBossChallenge();
              return;
            }
            if (menuStatus.coins < BOSS_COST){
              // disabledã§åŸºæœ¬æŠ¼ã›ãªã„ã‘ã©ã€ä¿é™º
              alert(`ã‚³ã‚¤ãƒ³ãŒè¶³ã‚Šãªã„ã‚ˆ ğŸª™\nå¿…è¦ï¼š${BOSS_COST}\nã„ã¾ï¼š${menuStatus.coins}`);
              return;
            }
            openUnlockModal();
          });

          // ãƒ¢ãƒ¼ãƒ€ãƒ«
          document.getElementById('mCancel').addEventListener('click', closeUnlockModal);
          document.getElementById('mOk').addEventListener('click', () => {
            closeUnlockModal();
            doUnlockBoss();
          });

          // GASãŒã‚ã‚‹ãªã‚‰æœ€æ–°åŒ–
          fetchMenuStatus();
        });
      });
    </script>
  </body>
</html>
